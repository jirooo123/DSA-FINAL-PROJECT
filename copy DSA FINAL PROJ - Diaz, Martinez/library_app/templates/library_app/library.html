{% extends 'base.html' %}

{% block content %}
<div style="text-align: center; margin-bottom: 30px;">
    <h1>The LeBrary</h1>
    
    <div class="search-container" style="background: white; padding: 20px; border-radius: 8px; display: inline-block; box-shadow: 0 2px 10px rgba(0,0,0,0.05);">
        
        <form method="get" style="margin-bottom: 15px;">
            <input type="text" name="q" placeholder="Search Title or ID..." value="{{ request.GET.q }}">
            <select name="type">
                <option value="title">Title (Binary Search)</option>
                <option value="id">ID (Hashing)</option>
            </select>
            <button type="submit">Search</button>
        </form>

        <div style="border-top: 1px solid #eee; margin: 15px 0;"></div>

        <div style="font-size: 0.95em;">
            <span style="font-weight: bold; color: #7f8c8d; margin-right: 10px;">Sort View:</span>
            
            <a href="{% url 'library_home' %}?sort=title&dir={{ next_title_dir }}" 
               class="sort-link {% if current_sort == 'title' %}active{% endif %}">
                Title 
                {% if current_sort == 'title' %}
                    {% if current_dir == 'asc' %}(A-Z) &#8595;{% else %}(Z-A) &#8593;{% endif %}
                {% else %}
                    (A-Z)
                {% endif %}
            </a>
            
            <span style="color: #ccc;">|</span>
            
            <a href="{% url 'library_home' %}?sort=year&dir={{ next_year_dir }}" 
               class="sort-link {% if current_sort == 'year' %}active{% endif %}">
                Year 
                {% if current_sort == 'year' %}
                    {% if current_dir == 'desc' %}(Newest) &#8595;{% else %}(Oldest) &#8593;{% endif %}
                {% else %}
                    (Newest)
                {% endif %}
            </a>
        </div>
    </div>
</div>

{% if message %}
    <p style="text-align:center; color: #e67e22; font-weight:bold; background: #fff3cd; padding: 10px; border-radius: 4px; max-width: 600px; margin: 0 auto 20px auto;">
        {{ message }}
    </p>
{% endif %}

<h2>Library Collection</h2>

{% for book in books %}
    <div class="book-card">
        <div style="display:flex; justify-content:space-between; align-items:center;">
            
            <div>
                <strong>{{ book.title }}</strong> <small>(ID: {{ book.id }})</small><br>
                <span style="font-size: 0.9em; color: #7f8c8d;">By {{ book.author }} | {{ book.year }}</span>
                
                <br>
                <span class="stock-status {% if book.available_stock > 0 %}stock-ok{% else %}stock-out{% endif %}">
                    Stock: {{ book.available_stock }} / {{ book.quantity }} Available
                </span>

                {% if book.pdf_stub %}
                    <br>
                    <a href="{{ book.pdf_stub.url }}" target="_blank" style="font-size: 0.85em; color: #27ae60; text-decoration: none;">
                        ðŸ“„ Preview PDF Stub
                    </a>
                {% endif %}
            </div>

            <div style="display: flex; gap: 10px;">
                
                {% if book.available_stock > 0 %}
                    <a href="{% url 'borrow_book' book.id %}" class="borrow-btn">Borrow</a>
                {% else %}
                    <button disabled style="background: #95a5a6; color: white; border:none; padding: 8px 15px; border-radius: 4px; cursor: not-allowed;">
                        Out of Stock
                    </button>
                {% endif %}

                {% if user.is_staff %}
                    <a href="{% url 'delete_book' book.id %}" 
                       class="delete-btn"
                       onclick="return confirm('Are you sure you want to delete {{ book.title }}?');">
                       Delete
                    </a>
                {% endif %}
                
            </div>
        </div>
    </div>
{% empty %}
    <p style="text-align: center; margin-top: 30px; color: #7f8c8d;">No books available in the library.</p>
{% endfor %}

{% endblock %}